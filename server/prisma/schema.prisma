generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model School {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                  String                 @db.VarChar(255)
  nameHindi             String?                @map("name_hindi") @db.VarChar(255)
  nameRegional          String?                @map("name_regional") @db.VarChar(255)
  code                  String                 @unique @db.VarChar(50)
  address               String?
  state                 String?                @db.VarChar(100)
  district              String?                @db.VarChar(100)
  boardAffiliation      String?                @map("board_affiliation") @db.VarChar(100)
  primaryLanguage       String?                @default("en") @map("primary_language") @db.VarChar(10)
  secondaryLanguages    String[]               @map("secondary_languages")
  academicYearStart     Int?                   @default(4) @map("academic_year_start")
  logoUrl               String?                @map("logo_url")
  letterheadUrl         String?                @map("letterhead_url") @db.VarChar(500)
  createdAt             DateTime?              @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt             DateTime?              @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  academicYears         AcademicYear[]
  assignments           Assignment[]
  auditLogs             AuditLog[]
  classes               Class[]
  documents             Document[]
  feeCategories         FeeCategory[]
  feeStructures         FeeStructure[]
  gradeScales           GradeScale[]
  import_history        ImportHistory[]
  labItems              LabItem[]
  labs                  Lab[]
  laptopIssuances       LaptopIssuance[]
  notificationTemplates NotificationTemplate[]
  procurementRequests   ProcurementRequest[]
  reportTemplates       ReportTemplate[]
  subjects              Subject[]
  users                 User[]
  vendors               Vendor[]
  whiteboardSessions    WhiteboardSession[]

  @@map("schools")
}

model GradeScale {
  id            String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId      String              @map("school_id") @db.Uuid
  gradeLetter   String              @map("grade_letter") @db.VarChar(5)
  gradePoint    Decimal             @map("grade_point") @db.Decimal(4, 2)
  minPercentage Int                 @map("min_percentage")
  maxPercentage Int                 @map("max_percentage")
  description   String?
  isActive      Boolean             @default(true) @map("is_active")
  createdAt     DateTime            @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime            @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  history       GradeScaleHistory[]
  school        School              @relation(fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([schoolId, gradeLetter])
  @@map("grade_scales")
}

model GradeScaleHistory {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  gradeScaleId   String     @map("grade_scale_id") @db.Uuid
  action         String     @db.VarChar(50)
  previousLetter String?    @map("previous_letter") @db.VarChar(10)
  previousMinPct Int?       @map("previous_min_pct")
  previousMaxPct Int?       @map("previous_max_pct")
  previousPoints Decimal?   @map("previous_points") @db.Decimal(4, 2)
  newLetter      String?    @map("new_letter") @db.VarChar(10)
  newMinPct      Int?       @map("new_min_pct")
  newMaxPct      Int?       @map("new_max_pct")
  newPoints      Decimal?   @map("new_points") @db.Decimal(4, 2)
  changedById    String     @map("changed_by_id") @db.Uuid
  changedAt      DateTime?  @default(now()) @map("changed_at") @db.Timestamptz(6)
  reason         String?
  users          User       @relation(fields: [changedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  gradeScale     GradeScale @relation(fields: [gradeScaleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([changedAt], map: "idx_grade_scale_history_changed_at")
  @@index([gradeScaleId], map: "idx_grade_scale_history_scale_id")
  @@map("grade_scale_history")
}

model AcademicYear {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId      String          @map("school_id") @db.Uuid
  yearLabel     String          @map("year_label") @db.VarChar(20)
  startDate     DateTime        @map("start_date") @db.Date
  endDate       DateTime        @map("end_date") @db.Date
  isCurrent     Boolean?        @default(false) @map("is_current")
  createdAt     DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  school        School          @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  assignments   Assignment[]
  classes       Class[]
  feeStructures FeeStructure[]
  finalLabMarks FinalLabMarks[]
  grades        Grade[]
  studentFees   StudentFee[]

  @@map("academic_years")
}

model User {
  id                                             String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId                                       String                   @map("school_id") @db.Uuid
  email                                          String                   @unique @db.VarChar(255)
  phone                                          String?                  @db.VarChar(20)
  passwordHash                                   String                   @map("password_hash")
  role                                           UserRole
  firstName                                      String                   @map("first_name") @db.VarChar(100)
  firstNameHindi                                 String?                  @map("first_name_hindi") @db.VarChar(100)
  firstNameRegional                              String?                  @map("first_name_regional") @db.VarChar(100)
  lastName                                       String                   @map("last_name") @db.VarChar(100)
  lastNameHindi                                  String?                  @map("last_name_hindi") @db.VarChar(100)
  lastNameRegional                               String?                  @map("last_name_regional") @db.VarChar(100)
  admissionNumber                                String?                  @map("admission_number") @db.VarChar(50)
  employeeId                                     String?                  @map("employee_id") @db.VarChar(50)
  profileImageUrl                                String?                  @map("profile_image_url")
  preferredLanguage                              String?                  @default("en") @map("preferred_language") @db.VarChar(10)
  isActive                                       Boolean?                 @default(true) @map("is_active")
  lastLogin                                      DateTime?                @map("last_login") @db.Timestamp(6)
  createdAt                                      DateTime?                @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt                                      DateTime?                @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  studentId                                      String?                  @map("student_id") @db.VarChar(50)
  resetPin                                       String?                  @map("reset_pin") @db.VarChar(255)
  pinExpiresAt                                   DateTime?                @map("pin_expires_at") @db.Timestamp(6)
  activityLogs                                   ActivityLog[]
  assignmentsAssigned                            AssignmentTarget[]
  assignmentsCreated                             Assignment[]
  auditLogs                                      AuditLog[]
  classEnrollments                               ClassEnrollment[]
  classSubjectsAsInstructor                      ClassSubject[]           @relation("Instructor")
  classSubjectsAsLabInstructor                   ClassSubject[]           @relation("LabInstructor")
  classTeacherOf                                 Class[]                  @relation("ClassTeacher")
  deviceTests                                    DeviceTest?
  documentSharesSent                             DocumentShare[]          @relation("DocumentSharedBy")
  documentSharesReceived                         DocumentShare[]          @relation("DocumentSharedToUser")
  documents                                      Document[]               @relation("DocumentUploadedBy")
  shiftHistoryApproved                           EquipmentShiftHistory[]  @relation("ShiftHistoryApprovedBy")
  shiftHistoryPerformed                          EquipmentShiftHistory[]  @relation("ShiftedBy")
  shiftRequestsApproved                          EquipmentShiftRequest[]  @relation("ShiftApprovedBy")
  shiftRequestsCreated                           EquipmentShiftRequest[]  @relation("ShiftRequestedBy")
  feePaymentsCollected                           FeePayment[]             @relation("Collector")
  finalMarksFinalized                            FinalLabMarks[]          @relation("FinalMarksFinalized")
  finalMarksAsStudent                            FinalLabMarks[]          @relation("FinalMarksStudent")
  reportsGenerated                               GeneratedReport[]
  grade_scale_history                            GradeScaleHistory[]
  gradesGiven                                    Grade[]                  @relation("GradedBy")
  gradesModified                                 Grade[]                  @relation("ModifiedBy")
  groupMemberships                               GroupMember[]
  importHistory                                  ImportHistory[]
  maintenanceRecords                             ItemMaintenanceHistory[] @relation("MaintenanceRecordedBy")
  lab_attendance_lab_attendance_marked_byTousers LabAttendance[]          @relation("lab_attendance_marked_byTousers")
  labAttendanceAsStudent                         LabAttendance[]          @relation("AttendanceStudent")
  labMaintenancePerformed                        LabMaintenanceHistory[]  @relation("LabMaintenancePerformer")
  materialUsageRecorded                          LabMaterialUsage[]       @relation("MaterialUsageRecorded")
  materialUsageAsStudent                         LabMaterialUsage[]       @relation("MaterialUsageStudent")
  labsInCharge                                   Lab[]
  laptopsIssuedBy                                LaptopIssuance[]         @relation("LaptopIssuedBy")
  laptopsIssuedTo                                LaptopIssuance[]         @relation("LaptopIssuedTo")
  laptopsReceivedBy                              LaptopIssuance[]         @relation("LaptopReceivedBy")
  notifications                                  Notification[]
  procurementCommittees                          ProcurementCommittee[]
  procurementsApproved                           ProcurementRequest[]     @relation("ProcurementApprovedBy")
  procurementsCreated                            ProcurementRequest[]     @relation("ProcurementCreatedBy")
  procurementsReceived                           ProcurementRequest[]     @relation("ProcurementReceivedBy")
  groupsCreated                                  StudentGroup[]
  submissions                                    Submission[]
  ticketComments                                 TicketComment[]
  ticketsAssigned                                Ticket[]                 @relation("TicketAssignee")
  ticketsCreated                                 Ticket[]                 @relation("TicketCreator")
  ticketsResolved                                Ticket[]                 @relation("TicketResolver")
  sessions                                       UserSession[]
  school                                         School                   @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vivaParticipations                             VivaParticipant[]
  vivaQuestionsCreated                           VivaQuestion[]
  vivaSessionsAsExaminer                         VivaSession[]            @relation("VivaExaminer")
  vivaSessionsAsStudent                          VivaSession[]            @relation("VivaStudent")
  whiteboardParticipations                       WhiteboardParticipant[]
  whiteboardSessionsAsHost                       WhiteboardSession[]      @relation("WhiteboardHost")
  procurementItemsReceived                       ProcurementItem[]        @relation("ProcurementItemReceivedBy")

  @@unique([schoolId, studentId], map: "unique_student_id_per_school")
  @@index([email], map: "idx_users_email")
  @@index([schoolId], map: "idx_users_school")
  @@index([studentId], map: "idx_users_student_id")
  @@map("users")
}

model DeviceTest {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String    @unique @map("user_id") @db.Uuid
  cameraStatus      String?   @map("camera_status") @db.VarChar(50)
  cameraTestedAt    DateTime? @map("camera_tested_at") @db.Timestamp(6)
  cameraDeviceId    String?   @map("camera_device_id")
  cameraDeviceName  String?   @map("camera_device_name")
  micStatus         String?   @map("mic_status") @db.VarChar(50)
  micTestedAt       DateTime? @map("mic_tested_at") @db.Timestamp(6)
  micDeviceId       String?   @map("mic_device_id")
  micDeviceName     String?   @map("mic_device_name")
  speakerStatus     String?   @map("speaker_status") @db.VarChar(50)
  speakerTestedAt   DateTime? @map("speaker_tested_at") @db.Timestamp(6)
  speakerDeviceId   String?   @map("speaker_device_id")
  speakerDeviceName String?   @map("speaker_device_name")
  speakerVolume     Int?      @map("speaker_volume")
  userAgent         String?   @map("user_agent")
  platform          String?   @db.VarChar(50)
  browser           String?   @db.VarChar(100)
  createdAt         DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId], map: "idx_device_tests_user_id")
  @@map("device_tests")
}

model UserSession {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  token     String
  ipAddress String?   @map("ip_address") @db.VarChar(50)
  userAgent String?   @map("user_agent")
  expiresAt DateTime  @map("expires_at") @db.Timestamp(6)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_sessions")
}

model Class {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId           String              @map("school_id") @db.Uuid
  academicYearId     String              @map("academic_year_id") @db.Uuid
  name               String              @db.VarChar(100)
  nameHindi          String?             @map("name_hindi") @db.VarChar(100)
  gradeLevel         Int                 @map("grade_level")
  section            String?             @db.VarChar(10)
  stream             String?             @db.VarChar(50)
  classTeacherId     String?             @map("class_teacher_id") @db.Uuid
  maxStudents        Int?                @default(60) @map("max_students")
  createdAt          DateTime?           @default(now()) @map("created_at") @db.Timestamp(6)
  enrollments        ClassEnrollment[]
  classSubjects      ClassSubject[]
  academicYear       AcademicYear        @relation(fields: [academicYearId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  classTeacher       User?               @relation("ClassTeacher", fields: [classTeacherId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school             School              @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  documentShares     DocumentShare[]
  feeStructures      FeeStructure[]
  finalLabMarks      FinalLabMarks[]
  labAttendance      LabAttendance[]
  groups             StudentGroup[]
  whiteboardSessions WhiteboardSession[]

  @@unique([schoolId, name], name: "unique_class_name_per_school")
  @@index([academicYearId])
  @@index([schoolId, academicYearId])
  @@index([schoolId], map: "idx_classes_school")
  @@map("classes")
}

model ClassEnrollment {
  id             String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  studentId      String            @map("student_id") @db.Uuid
  classId        String            @map("class_id") @db.Uuid
  rollNumber     Int?              @map("roll_number")
  enrollmentDate DateTime?         @default(now()) @map("enrollment_date") @db.Timestamp(6)
  status         EnrollmentStatus? @default(active)
  class          Class             @relation(fields: [classId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  student        User              @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([studentId, classId])
  @@index([classId], map: "idx_enrollments_class")
  @@index([studentId], map: "idx_enrollments_student")
  @@map("class_enrollments")
}

model StudentGroup {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  classId            String              @map("class_id") @db.Uuid
  name               String              @db.VarChar(100)
  nameHindi          String?             @map("name_hindi") @db.VarChar(100)
  description        String?
  createdById        String              @map("created_by") @db.Uuid
  createdAt          DateTime?           @default(now()) @map("created_at") @db.Timestamp(6)
  assignedPcId       String?             @map("assigned_pc_id") @db.Uuid
  targets            AssignmentTarget[]
  documentShares     DocumentShare[]
  members            GroupMember[]
  assignedPc         LabItem?            @relation(fields: [assignedPcId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  class              Class               @relation(fields: [classId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  createdBy          User                @relation(fields: [createdById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  submissions        Submission[]
  whiteboardSessions WhiteboardSession[]

  @@unique([classId, name], name: "unique_group_name_per_class")
  @@map("student_groups")
}

model GroupMember {
  id        String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  groupId   String       @map("group_id") @db.Uuid
  studentId String       @map("student_id") @db.Uuid
  role      GroupRole?   @default(member)
  joinedAt  DateTime?    @default(now()) @map("joined_at") @db.Timestamp(6)
  group     StudentGroup @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  student   User         @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([groupId, studentId])
  @@map("group_members")
}

model Subject {
  id                 String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId           String          @map("school_id") @db.Uuid
  code               String          @db.VarChar(20)
  name               String          @db.VarChar(100)
  nameHindi          String?         @map("name_hindi") @db.VarChar(100)
  nameRegional       String?         @map("name_regional") @db.VarChar(100)
  hasLab             Boolean?        @default(false) @map("has_lab")
  labHoursPerWeek    Int?            @default(0) @map("lab_hours_per_week")
  theoryHoursPerWeek Int?            @default(0) @map("theory_hours_per_week")
  createdAt          DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  assignments        Assignment[]
  classSubjects      ClassSubject[]
  feeStructures      FeeStructure[]
  finalLabMarks      FinalLabMarks[]
  labs               Lab[]
  school             School          @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vivaQuestions      VivaQuestion[]

  @@map("subjects")
}

model ClassSubject {
  id              String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  classId         String  @map("class_id") @db.Uuid
  subjectId       String  @map("subject_id") @db.Uuid
  instructorId    String? @map("instructor_id") @db.Uuid
  labInstructorId String? @map("lab_instructor_id") @db.Uuid
  class           Class   @relation(fields: [classId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  instructor      User?   @relation("Instructor", fields: [instructorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  labInstructor   User?   @relation("LabInstructor", fields: [labInstructorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject         Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([classId, subjectId])
  @@map("class_subjects")
}

model Lab {
  id                   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId             String                  @map("school_id") @db.Uuid
  name                 String                  @db.VarChar(100)
  nameHindi            String?                 @map("name_hindi") @db.VarChar(100)
  roomNumber           String?                 @map("room_number") @db.VarChar(20)
  capacity             Int?                    @default(30)
  subjectId            String?                 @map("subject_id") @db.Uuid
  equipmentList        Json?                   @map("equipment_list")
  inchargeId           String?                 @map("incharge_id") @db.Uuid
  status               String?                 @default("active") @db.VarChar(20)
  maintenanceReason    String?                 @map("maintenance_reason")
  maintenanceStartDate DateTime?               @map("maintenance_start_date") @db.Timestamp(6)
  maintenanceEndDate   DateTime?               @map("maintenance_end_date") @db.Timestamp(6)
  createdAt            DateTime?               @default(now()) @map("created_at") @db.Timestamp(6)
  assignments          Assignment[]
  shiftHistoryFrom     EquipmentShiftHistory[] @relation("ShiftHistoryFromLab")
  shiftHistoryTo       EquipmentShiftHistory[] @relation("ShiftHistoryToLab")
  shiftRequestsFrom    EquipmentShiftRequest[] @relation("ShiftFromLab")
  shiftRequestsTo      EquipmentShiftRequest[] @relation("ShiftToLab")
  importHistory        ImportHistory[]
  attendance           LabAttendance[]
  items                LabItem[]
  maintenanceHistory   LabMaintenanceHistory[]
  lab_materials        lab_materials[]
  incharge             User?                   @relation(fields: [inchargeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school               School                  @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  subject              Subject?                @relation(fields: [subjectId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tickets              Ticket[]

  @@map("labs")
}

model LabMaintenanceHistory {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  labId           String    @map("lab_id") @db.Uuid
  action          String    @db.VarChar(20)
  reason          String?
  previousStatus  String?   @map("previous_status") @db.VarChar(20)
  newStatus       String    @map("new_status") @db.VarChar(20)
  startedAt       DateTime? @map("started_at") @db.Timestamp(6)
  endedAt         DateTime? @map("ended_at") @db.Timestamp(6)
  expectedEndDate DateTime? @map("expected_end_date") @db.Timestamp(6)
  performedById   String?   @map("performed_by_id") @db.Uuid
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  lab             Lab       @relation(fields: [labId], references: [id], onDelete: Cascade)
  performedBy     User?     @relation("LabMaintenancePerformer", fields: [performedById], references: [id])

  @@map("lab_maintenance_history")
}

model LabItem {
  id                 String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  labId              String?                  @map("lab_id") @db.Uuid
  schoolId           String?                  @map("school_id") @db.Uuid
  itemType           String                   @map("item_type") @db.VarChar(50)
  itemNumber         String                   @map("item_number") @db.VarChar(100)
  brand              String?                  @db.VarChar(100)
  modelNo            String?                  @map("model_no") @db.VarChar(100)
  serialNo           String?                  @map("serial_no") @db.VarChar(100)
  specs              Json?
  status             String?                  @default("active") @db.VarChar(20)
  notes              String?
  purchaseDate       DateTime?                @map("purchase_date") @db.Timestamp(6)
  warrantyEnd        DateTime?                @map("warranty_end") @db.Timestamp(6)
  createdAt          DateTime?                @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime?                @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  quantity           Int?                     @default(1)
  imageUrl           String?                  @map("image_url")
  shiftHistory       EquipmentShiftHistory[]  @relation("ShiftHistory")
  shiftRequests      EquipmentShiftRequest[]  @relation("ShiftRequests")
  maintenanceHistory ItemMaintenanceHistory[]
  lab                Lab?                     @relation(fields: [labId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  school             School?                  @relation(fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  issuances          LaptopIssuance[]
  procurementItems   ProcurementItem[]
  assignedGroups     StudentGroup[]
  tickets            Ticket[]

  @@unique([labId, itemNumber])
  @@map("lab_items")
}

model ImportHistory {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId      String    @map("school_id") @db.Uuid
  labId         String    @map("lab_id") @db.Uuid
  uploadedById  String    @map("uploaded_by") @db.Uuid
  fileName      String    @map("file_name") @db.VarChar(255)
  fileSize      Int?      @map("file_size")
  itemsImported Int       @map("items_imported")
  itemsFailed   Int?      @default(0) @map("items_failed")
  status        String?   @default("completed") @db.VarChar(50)
  errors        Json?
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  lab           Lab       @relation(fields: [labId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  schools       School    @relation(fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  uploadedBy    User      @relation(fields: [uploadedById], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([createdAt(sort: Desc)], map: "idx_import_history_created_at")
  @@index([labId], map: "idx_import_history_lab_id")
  @@index([schoolId], map: "idx_import_history_school_id")
  @@map("import_history")
}

model ItemMaintenanceHistory {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId       String    @map("item_id") @db.Uuid
  recordedById String    @map("recorded_by") @db.Uuid
  type         String    @db.VarChar(50)
  description  String
  cost         Decimal?  @db.Decimal(10, 2)
  vendor       String?   @db.VarChar(255)
  partName     String?   @map("part_name") @db.VarChar(255)
  resolvedAt   DateTime? @map("resolved_at") @db.Timestamp(6)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  item         LabItem   @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recordedBy   User      @relation("MaintenanceRecordedBy", fields: [recordedById], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("item_maintenance_history")
}

model EquipmentShiftRequest {
  id            String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId        String                  @map("item_id") @db.Uuid
  fromLabId     String                  @map("from_lab_id") @db.Uuid
  toLabId       String                  @map("to_lab_id") @db.Uuid
  requestedById String                  @map("requested_by") @db.Uuid
  approvedById  String?                 @map("approved_by") @db.Uuid
  status        EquipmentShiftStatus?   @default(pending)
  reason        String?
  adminNotes    String?                 @map("admin_notes")
  requestedAt   DateTime?               @default(now()) @map("requested_at") @db.Timestamp(6)
  approvedAt    DateTime?               @map("approved_at") @db.Timestamp(6)
  completedAt   DateTime?               @map("completed_at") @db.Timestamp(6)
  shiftHistory  EquipmentShiftHistory[]
  approvedBy    User?                   @relation("ShiftApprovedBy", fields: [approvedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  fromLab       Lab                     @relation("ShiftFromLab", fields: [fromLabId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  item          LabItem                 @relation("ShiftRequests", fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  requestedBy   User                    @relation("ShiftRequestedBy", fields: [requestedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  toLab         Lab                     @relation("ShiftToLab", fields: [toLabId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([itemId], map: "idx_shift_requests_item")
  @@index([status], map: "idx_shift_requests_status")
  @@map("equipment_shift_requests")
}

model EquipmentShiftHistory {
  id             String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId         String                 @map("item_id") @db.Uuid
  fromLabId      String                 @map("from_lab_id") @db.Uuid
  toLabId        String                 @map("to_lab_id") @db.Uuid
  shiftedById    String                 @map("shifted_by") @db.Uuid
  approvedById   String?                @map("approved_by") @db.Uuid
  shiftRequestId String?                @map("shift_request_id") @db.Uuid
  notes          String?
  shiftedAt      DateTime?              @default(now()) @map("shifted_at") @db.Timestamp(6)
  approvedBy     User?                  @relation("ShiftHistoryApprovedBy", fields: [approvedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  fromLab        Lab                    @relation("ShiftHistoryFromLab", fields: [fromLabId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  item           LabItem                @relation("ShiftHistory", fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  shiftRequest   EquipmentShiftRequest? @relation(fields: [shiftRequestId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shiftedBy      User                   @relation("ShiftedBy", fields: [shiftedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  toLab          Lab                    @relation("ShiftHistoryToLab", fields: [toLabId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([itemId], map: "idx_shift_history_item")
  @@map("equipment_shift_history")
}

model Document {
  id           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId     String          @map("school_id") @db.Uuid
  uploadedById String          @map("uploaded_by") @db.Uuid
  name         String          @db.VarChar(255)
  description  String?
  fileName     String          @map("file_name") @db.VarChar(255)
  fileType     String          @map("file_type") @db.VarChar(50)
  mimeType     String          @map("mime_type") @db.VarChar(100)
  fileSize     Int             @map("file_size")
  cloudinaryId String          @map("cloudinary_id") @db.VarChar(255)
  url          String
  isPublic     Boolean?        @default(false) @map("is_public")
  category     String?         @db.VarChar(100)
  createdAt    DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime?       @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  shares       DocumentShare[]
  school       School          @relation(fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  uploadedBy   User            @relation("DocumentUploadedBy", fields: [uploadedById], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([schoolId], map: "idx_documents_school_id")
  @@index([uploadedById], map: "idx_documents_uploaded_by")
  @@map("documents")
}

model DocumentShare {
  id            String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  documentId    String                     @map("document_id") @db.Uuid
  sharedById    String                     @map("shared_by_id") @db.Uuid
  targetType    document_share_target_type @map("target_type")
  targetClassId String?                    @map("target_class_id") @db.Uuid
  targetGroupId String?                    @map("target_group_id") @db.Uuid
  targetUserId  String?                    @map("target_user_id") @db.Uuid
  message       String?
  sharedAt      DateTime?                  @default(now()) @map("shared_at") @db.Timestamp(6)
  expiresAt     DateTime?                  @map("expires_at") @db.Timestamp(6)
  document      Document                   @relation(fields: [documentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sharedBy      User                       @relation("DocumentSharedBy", fields: [sharedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  targetClass   Class?                     @relation(fields: [targetClassId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  targetGroup   StudentGroup?              @relation(fields: [targetGroupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  targetUser    User?                      @relation("DocumentSharedToUser", fields: [targetUserId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([targetClassId], map: "idx_document_shares_class")
  @@index([documentId], map: "idx_document_shares_document")
  @@index([targetGroupId], map: "idx_document_shares_group")
  @@index([sharedAt], map: "idx_document_shares_shared_at")
  @@index([targetUserId], map: "idx_document_shares_user")
  @@map("document_shares")
}

model Assignment {
  id                    String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId              String             @map("school_id") @db.Uuid
  subjectId             String             @map("subject_id") @db.Uuid
  labId                 String?            @map("lab_id") @db.Uuid
  createdById           String             @map("created_by") @db.Uuid
  title                 String             @db.VarChar(255)
  titleHindi            String?            @map("title_hindi") @db.VarChar(255)
  titleRegional         String?            @map("title_regional") @db.VarChar(255)
  description           String?
  descriptionHindi      String?            @map("description_hindi")
  descriptionRegional   String?            @map("description_regional")
  experimentNumber      String?            @map("experiment_number") @db.VarChar(20)
  assignmentType        AssignmentType     @map("assignment_type")
  programmingLanguage   String?            @map("programming_language") @db.VarChar(50)
  aim                   String?
  aimHindi              String?            @map("aim_hindi")
  theory                String?
  theoryHindi           String?            @map("theory_hindi")
  procedure             String?
  procedureHindi        String?            @map("procedure_hindi")
  expectedOutput        String?            @map("expected_output")
  referenceCode         String?            @map("reference_code")
  attachments           Json?
  maxMarks              Int?               @default(100) @map("max_marks")
  passingMarks          Int?               @default(35) @map("passing_marks")
  vivaMarks             Int?               @default(20) @map("viva_marks")
  practicalMarks        Int?               @default(60) @map("practical_marks")
  outputMarks           Int?               @default(20) @map("output_marks")
  publish_date          DateTime?          @db.Timestamp(6)
  due_date              DateTime?          @db.Timestamp(6)
  lateSubmissionAllowed Boolean?           @default(true) @map("late_submission_allowed")
  latePenaltyPercent    Int?               @default(10) @map("late_penalty_percent")
  status                AssignmentStatus?  @default(draft)
  createdAt             DateTime?          @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt             DateTime?          @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  academicYearId        String?            @map("academic_year_id") @db.Uuid
  pdfAttachmentUrl      String?            @map("pdf_attachment_url")
  pdfAttachmentName     String?            @map("pdf_attachment_name") @db.VarChar(255)
  pdfCloudinaryId       String?            @map("pdf_cloudinary_id") @db.VarChar(255)
  files                 AssignmentFile[]
  targets               AssignmentTarget[]
  academicYear          AcademicYear?      @relation(fields: [academicYearId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdBy             User               @relation(fields: [createdById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lab                   Lab?               @relation(fields: [labId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school                School             @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  subject               Subject            @relation(fields: [subjectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  materialUsage         LabMaterialUsage[]
  submissions           Submission[]
  vivaQuestions         VivaQuestion[]

  @@index([academicYearId])
  @@index([schoolId, academicYearId])
  @@index([subjectId, academicYearId])
  @@index([status])
  @@index([schoolId], map: "idx_assignments_school")
  @@map("assignments")
}

model AssignmentFile {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  assignmentId String     @map("assignment_id") @db.Uuid
  fileName     String     @map("file_name") @db.VarChar(255)
  fileType     String?    @map("file_type") @db.VarChar(50)
  fileSize     Int?       @map("file_size")
  fileUrl      String     @map("file_url")
  uploadedById String     @map("uploaded_by") @db.Uuid
  uploadedAt   DateTime?  @default(now()) @map("uploaded_at") @db.Timestamp(6)
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("assignment_files")
}

model AssignmentTarget {
  id                  String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  assignmentId        String        @map("assignment_id") @db.Uuid
  targetType          TargetType    @map("target_type")
  targetClassId       String?       @map("target_class_id") @db.Uuid
  targetGroupId       String?       @map("target_group_id") @db.Uuid
  targetStudentId     String?       @map("target_student_id") @db.Uuid
  assignedById        String        @map("assigned_by") @db.Uuid
  assignedAt          DateTime?     @default(now()) @map("assigned_at") @db.Timestamp(6)
  specialInstructions String?       @map("special_instructions")
  extendedDueDate     DateTime?     @map("extended_due_date") @db.Timestamp(6)
  publishDate         DateTime?     @map("publish_date") @db.Timestamp(6)
  dueDate             DateTime?     @map("due_date") @db.Timestamp(6)
  isLocked            Boolean       @default(false) @map("is_locked")
  assignedBy          User          @relation(fields: [assignedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  assignment          Assignment    @relation(fields: [assignmentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  targetGroup         StudentGroup? @relation(fields: [targetGroupId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("assignment_targets")
}

model Submission {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  assignmentId        String               @map("assignment_id") @db.Uuid
  studentId           String               @map("student_id") @db.Uuid
  groupId             String?              @map("group_id") @db.Uuid
  codeContent         String?              @map("code_content")
  outputContent       String?              @map("output_content")
  observations        String?
  observationsHindi   String?              @map("observations_hindi")
  conclusion          String?
  conclusionHindi     String?              @map("conclusion_hindi")
  attachments         Json?
  outputScreenshotUrl String?              @map("output_screenshot_url")
  submissionNumber    Int?                 @default(1) @map("submission_number")
  isLate              Boolean?             @default(false) @map("is_late")
  lateDays            Int?                 @default(0) @map("late_days")
  status              SubmissionStatus?    @default(submitted)
  submittedAt         DateTime?            @default(now()) @map("submitted_at") @db.Timestamp(6)
  lastModified        DateTime?            @default(now()) @updatedAt @map("last_modified") @db.Timestamp(6)
  grade               Grade?
  files               SubmissionFile[]
  revisions           SubmissionRevision[]
  assignment          Assignment           @relation(fields: [assignmentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  group               StudentGroup?        @relation(fields: [groupId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student             User                 @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vivaSessions        VivaSession[]

  @@unique([assignmentId, studentId, submissionNumber])
  @@index([assignmentId])
  @@index([studentId])
  @@index([status])
  @@index([assignmentId], map: "idx_submissions_assignment")
  @@index([studentId], map: "idx_submissions_student")
  @@map("submissions")
}

model SubmissionFile {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  submissionId String     @map("submission_id") @db.Uuid
  fileName     String     @map("file_name") @db.VarChar(255)
  fileType     String?    @map("file_type") @db.VarChar(50)
  fileSize     Int?       @map("file_size")
  fileUrl      String     @map("file_url")
  isOutput     Boolean?   @default(false) @map("is_output")
  uploadedAt   DateTime?  @default(now()) @map("uploaded_at") @db.Timestamp(6)
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("submission_files")
}

model SubmissionRevision {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  submissionId   String     @map("submission_id") @db.Uuid
  revisionNumber Int        @map("revision_number")
  codeContent    String?    @map("code_content")
  outputContent  String?    @map("output_content")
  attachments    Json?
  revisionNote   String?    @map("revision_note")
  createdAt      DateTime?  @default(now()) @map("created_at") @db.Timestamp(6)
  submission     Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("submission_revisions")
}

model VivaSession {
  id                     String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  submissionId           String            @map("submission_id") @db.Uuid
  studentId              String            @map("student_id") @db.Uuid
  examinerId             String            @map("examiner_id") @db.Uuid
  scheduledAt            DateTime?         @map("scheduled_at") @db.Timestamp(6)
  durationMinutes        Int?              @default(10) @map("duration_minutes")
  actualStartTime        DateTime?         @map("actual_start_time") @db.Timestamp(6)
  actualEndTime          DateTime?         @map("actual_end_time") @db.Timestamp(6)
  mode                   VivaMode?         @default(online)
  meetingLink            String?           @map("meeting_link")
  recordingUrl           String?           @map("recording_url")
  questionsAsked         Json?             @map("questions_asked")
  studentResponses       Json?             @map("student_responses")
  marksObtained          Decimal?          @map("marks_obtained") @db.Decimal(5, 2)
  maxMarks               Decimal?          @map("max_marks") @db.Decimal(5, 2)
  performanceRating      Int?              @map("performance_rating")
  examinerRemarks        String?           @map("examiner_remarks")
  examinerRemarksHindi   String?           @map("examiner_remarks_hindi")
  improvementSuggestions String?           @map("improvement_suggestions")
  status                 VivaStatus?       @default(scheduled)
  createdAt              DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt              DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  scheduledEndTime       DateTime?         @map("scheduled_end_time") @db.Timestamp(6)
  autoStart              Boolean?          @default(true) @map("auto_start")
  autoAdmit              Boolean?          @default(true) @map("auto_admit")
  recordingFilePath      String?           @map("recording_file_path")
  recordingSize          Int?              @map("recording_size_bytes")
  recordingDuration      Int?              @map("recording_duration_seconds")
  participants           VivaParticipant[]
  examiner               User              @relation("VivaExaminer", fields: [examinerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student                User              @relation("VivaStudent", fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  submission             Submission        @relation(fields: [submissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status, autoStart, scheduledAt], map: "idx_viva_sessions_auto_start")
  @@map("viva_sessions")
}

model VivaParticipant {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId       String            @map("session_id") @db.Uuid
  userId          String            @map("user_id") @db.Uuid
  role            String            @default("student") @db.VarChar(50)
  status          ParticipantStatus @default(waiting)
  joinedWaitingAt DateTime          @default(now()) @map("joined_waiting_at") @db.Timestamp(6)
  admittedAt      DateTime?         @map("admitted_at") @db.Timestamp(6)
  leftAt          DateTime?         @map("left_at") @db.Timestamp(6)
  socketId        String?           @map("socket_id") @db.VarChar(255)
  isVideoEnabled  Boolean           @default(false) @map("is_video_enabled")
  isAudioEnabled  Boolean           @default(false) @map("is_audio_enabled")
  session         VivaSession       @relation(fields: [sessionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user            User              @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([sessionId, userId])
  @@index([sessionId], map: "idx_viva_participants_session")
  @@index([status], map: "idx_viva_participants_status")
  @@index([userId], map: "idx_viva_participants_user")
  @@map("viva_participants")
}

model VivaQuestion {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subjectId           String           @map("subject_id") @db.Uuid
  assignmentId        String?          @map("assignment_id") @db.Uuid
  question            String
  questionHindi       String?          @map("question_hindi")
  expectedAnswer      String?          @map("expected_answer")
  expectedAnswerHindi String?          @map("expected_answer_hindi")
  difficulty          DifficultyLevel? @default(medium)
  marks               Int?             @default(2)
  topicTags           String[]         @map("topic_tags")
  createdById         String           @map("created_by") @db.Uuid
  createdAt           DateTime?        @default(now()) @map("created_at") @db.Timestamp(6)
  assignment          Assignment?      @relation(fields: [assignmentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  createdBy           User             @relation(fields: [createdById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject             Subject          @relation(fields: [subjectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("viva_questions")
}

model Grade {
  id                  String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  submissionId        String         @unique @map("submission_id") @db.Uuid
  studentId           String         @map("student_id") @db.Uuid
  gradedById          String         @map("graded_by") @db.Uuid
  practicalMarks      Decimal?       @default(0) @map("practical_marks") @db.Decimal(5, 2)
  outputMarks         Decimal?       @default(0) @map("output_marks") @db.Decimal(5, 2)
  vivaMarks           Decimal?       @default(0) @map("viva_marks") @db.Decimal(5, 2)
  totalMarks          Decimal?       @map("total_marks") @db.Decimal(5, 2)
  maxMarks            Decimal?       @map("max_marks") @db.Decimal(5, 2)
  percentage          Decimal?       @db.Decimal(5, 2)
  gradeLetter         String?        @map("grade_letter") @db.VarChar(5)
  latePenaltyMarks    Decimal?       @default(0) @map("late_penalty_marks") @db.Decimal(5, 2)
  finalMarks          Decimal?       @map("final_marks") @db.Decimal(5, 2)
  codeFeedback        String?        @map("code_feedback")
  codeFeedbackHindi   String?        @map("code_feedback_hindi")
  outputFeedback      String?        @map("output_feedback")
  generalRemarks      String?        @map("general_remarks")
  generalRemarksHindi String?        @map("general_remarks_hindi")
  isPublished         Boolean?       @default(false) @map("is_published")
  publishedAt         DateTime?      @map("published_at") @db.Timestamp(6)
  gradedAt            DateTime?      @default(now()) @map("graded_at") @db.Timestamp(6)
  updatedAt           DateTime?      @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  academicYearId      String?        @map("academic_year_id") @db.Uuid
  modifiedAt          DateTime?      @map("modified_at") @db.Timestamp(6)
  modifiedById        String?        @map("modified_by_id") @db.Uuid
  history             GradeHistory[]
  academicYear        AcademicYear?  @relation(fields: [academicYearId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  gradedBy            User           @relation("GradedBy", fields: [gradedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  modifiedBy          User?          @relation("ModifiedBy", fields: [modifiedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  submission          Submission     @relation(fields: [submissionId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([academicYearId])
  @@index([studentId])
  @@index([academicYearId], map: "idx_grades_academic_year")
  @@index([modifiedAt], map: "idx_grades_modified_at")
  @@index([submissionId], map: "idx_grades_submission")
  @@map("grades")
}

model GradeHistory {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  gradeId       String    @map("grade_id") @db.Uuid
  previousMarks Json      @map("previous_marks")
  newMarks      Json      @map("new_marks")
  reason        String?
  modifiedById  String    @map("modified_by") @db.Uuid
  modifiedAt    DateTime? @default(now()) @map("modified_at") @db.Timestamp(6)
  grade         Grade     @relation(fields: [gradeId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("grade_history")
}

model FinalLabMarks {
  id                   String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  studentId            String       @map("student_id") @db.Uuid
  subjectId            String       @map("subject_id") @db.Uuid
  classId              String       @map("class_id") @db.Uuid
  academicYearId       String       @map("academic_year_id") @db.Uuid
  totalAssignments     Int          @map("total_assignments")
  completedAssignments Int          @map("completed_assignments")
  internalMarks        Decimal?     @map("internal_marks") @db.Decimal(5, 2)
  vivaAverage          Decimal?     @map("viva_average") @db.Decimal(5, 2)
  practicalExamMarks   Decimal?     @map("practical_exam_marks") @db.Decimal(5, 2)
  totalMarks           Decimal?     @map("total_marks") @db.Decimal(5, 2)
  maxMarks             Decimal?     @map("max_marks") @db.Decimal(5, 2)
  percentage           Decimal?     @db.Decimal(5, 2)
  gradeLetter          String?      @map("grade_letter") @db.VarChar(5)
  gradePoints          Decimal?     @map("grade_points") @db.Decimal(3, 2)
  remarks              String?
  isPass               Boolean?     @map("is_pass")
  finalizedById        String?      @map("finalized_by") @db.Uuid
  finalizedAt          DateTime?    @map("finalized_at") @db.Timestamp(6)
  academicYear         AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  class                Class        @relation(fields: [classId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  finalizedBy          User?        @relation("FinalMarksFinalized", fields: [finalizedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student              User         @relation("FinalMarksStudent", fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subject              Subject      @relation(fields: [subjectId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([studentId, subjectId, academicYearId])
  @@map("final_lab_marks")
}

model FeeCategory {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId      String         @map("school_id") @db.Uuid
  name          String         @db.VarChar(100)
  nameHindi     String?        @map("name_hindi") @db.VarChar(100)
  description   String?
  isRecurring   Boolean?       @default(true) @map("is_recurring")
  frequency     FeeFrequency?  @default(yearly)
  createdAt     DateTime?      @default(now()) @map("created_at") @db.Timestamp(6)
  school        School         @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  feeStructures FeeStructure[]

  @@map("fee_categories")
}

model FeeStructure {
  id                   String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId             String       @map("school_id") @db.Uuid
  academicYearId       String       @map("academic_year_id") @db.Uuid
  feeCategoryId        String       @map("fee_category_id") @db.Uuid
  classId              String?      @map("class_id") @db.Uuid
  subjectId            String?      @map("subject_id") @db.Uuid
  amount               Decimal      @db.Decimal(10, 2)
  currency             String?      @default("INR") @db.VarChar(10)
  dueDate              DateTime?    @map("due_date") @db.Timestamp(6)
  concessionApplicable Boolean?     @default(true) @map("concession_applicable")
  createdAt            DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  academicYear         AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  class                Class?       @relation(fields: [classId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  feeCategory          FeeCategory  @relation(fields: [feeCategoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  school               School       @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  subject              Subject?     @relation(fields: [subjectId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  studentFees          StudentFee[]

  @@map("fee_structures")
}

model StudentFee {
  id               String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  studentId        String       @map("student_id") @db.Uuid
  feeStructureId   String       @map("fee_structure_id") @db.Uuid
  academicYearId   String       @map("academic_year_id") @db.Uuid
  baseAmount       Decimal      @map("base_amount") @db.Decimal(10, 2)
  concessionAmount Decimal?     @default(0) @map("concession_amount") @db.Decimal(10, 2)
  concessionReason String?      @map("concession_reason")
  finalAmount      Decimal      @map("final_amount") @db.Decimal(10, 2)
  status           FeeStatus?   @default(pending)
  dueDate          DateTime?    @map("due_date") @db.Timestamp(6)
  createdAt        DateTime?    @default(now()) @map("created_at") @db.Timestamp(6)
  payments         FeePayment[]
  academicYear     AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  feeStructure     FeeStructure @relation(fields: [feeStructureId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("student_fees")
}

model FeePayment {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  studentFeeId  String      @map("student_fee_id") @db.Uuid
  studentId     String      @map("student_id") @db.Uuid
  amount        Decimal     @db.Decimal(10, 2)
  paymentMode   PaymentMode @map("payment_mode")
  transactionId String?     @map("transaction_id") @db.VarChar(100)
  receiptNumber String?     @unique @map("receipt_number") @db.VarChar(50)
  paymentDate   DateTime?   @default(now()) @map("payment_date") @db.Timestamp(6)
  collectedById String      @map("collected_by") @db.Uuid
  remarks       String?
  createdAt     DateTime?   @default(now()) @map("created_at") @db.Timestamp(6)
  collectedBy   User        @relation("Collector", fields: [collectedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  studentFee    StudentFee  @relation(fields: [studentFeeId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("fee_payments")
}

model LabMaterialUsage {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  material_id   String        @db.Uuid
  assignmentId  String?       @map("assignment_id") @db.Uuid
  studentId     String        @map("student_id") @db.Uuid
  quantityUsed  Decimal       @map("quantity_used") @db.Decimal(10, 2)
  usageDate     DateTime?     @default(now()) @map("usage_date") @db.Timestamp(6)
  recordedById  String        @map("recorded_by") @db.Uuid
  remarks       String?
  createdAt     DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  assignment    Assignment?   @relation(fields: [assignmentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lab_materials lab_materials @relation(fields: [material_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recordedBy    User          @relation("MaterialUsageRecorded", fields: [recordedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student       User          @relation("MaterialUsageStudent", fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("lab_material_usage")
}

model ActivityLog {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String        @map("user_id") @db.Uuid
  actionType        ActivityType? @map("activity_type")
  description       String
  description_hindi String?
  entityType        String?       @map("entity_type") @db.VarChar(50)
  entityId          String?       @map("entity_id") @db.Uuid
  ipAddress         String?       @map("ip_address") @db.VarChar(50)
  userAgent         String?       @map("user_agent")
  createdAt         DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  schoolId          String?       @map("school_id") @db.Uuid
  action_type       String        @default("system")
  metadata          Json?
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([createdAt])
  @@index([schoolId, createdAt])
  @@index([userId])
  @@map("activity_logs")
}

model LabAttendance {
  id                                    String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  labId                                 String            @map("lab_id") @db.Uuid
  classId                               String            @map("class_id") @db.Uuid
  studentId                             String            @map("student_id") @db.Uuid
  date                                  DateTime          @db.Date
  status                                AttendanceStatus? @default(present)
  marked_by                             String            @db.Uuid
  remarks                               String?
  createdAt                             DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  class                                 Class             @relation(fields: [classId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lab                                   Lab               @relation(fields: [labId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_lab_attendance_marked_byTousers User              @relation("lab_attendance_marked_byTousers", fields: [marked_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  student                               User              @relation("AttendanceStudent", fields: [studentId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("lab_attendance")
}

model ReportTemplate {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId         String            @map("school_id") @db.Uuid
  name             String            @db.VarChar(100)
  type             ReportType
  template_content String?
  header_html      String?
  footer_html      String?
  styles           String?
  is_default       Boolean?          @default(false)
  createdAt        DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  generatedReports GeneratedReport[]
  school           School            @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("report_templates")
}

model GeneratedReport {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  templateId    String         @map("template_id") @db.Uuid
  generatedById String         @map("generated_by") @db.Uuid
  fileUrl       String         @map("file_url")
  parameters    Json?
  generatedAt   DateTime?      @default(now()) @map("generated_at") @db.Timestamp(6)
  generatedBy   User           @relation(fields: [generatedById], references: [id], onDelete: NoAction, onUpdate: NoAction)
  template      ReportTemplate @relation(fields: [templateId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("generated_reports")
}

model Translation {
  id           String   @id @default(uuid())
  entityType   String   @map("entity_type")
  entityKey    String   @map("entity_key")
  languageCode String   @map("language_code")
  translation  String
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([entityType, entityKey, languageCode])
  @@map("translations")
}

model NotificationTemplate {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId            String    @map("school_id") @db.Uuid
  name                String    @db.VarChar(100)
  subject             String?   @db.VarChar(255)
  subjectHindi        String?   @map("subject_hindi") @db.VarChar(255)
  body_template       String
  body_template_hindi String?
  trigger_event       String?   @db.VarChar(100)
  channels            String[]
  isActive            Boolean?  @default(true) @map("is_active")
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  school              School    @relation(fields: [schoolId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("notification_templates")
}

model Notification {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String    @map("user_id") @db.Uuid
  title          String    @db.VarChar(255)
  title_hindi    String?   @db.VarChar(255)
  message        String
  message_hindi  String?
  type           String?   @db.VarChar(50)
  reference_type String?   @db.VarChar(50)
  reference_id   String?   @db.Uuid
  is_read        Boolean?  @default(false)
  readAt         DateTime? @map("read_at") @db.Timestamp(6)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  templateId     String?   @map("template_id") @db.Uuid
  action_url     String?
  channel        String?   @default("in_app")
  scheduled_for  DateTime? @db.Timestamp(6)
  sentAt         DateTime? @map("sent_at") @db.Timestamp(6)
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId], map: "idx_notifications_user")
  @@map("notifications")
}

model lab_materials {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lab_id             String             @db.Uuid
  name               String             @db.VarChar(100)
  name_hindi         String?            @db.VarChar(100)
  description        String?
  unit               MaterialUnit
  cost_per_unit      Decimal?           @db.Decimal(10, 2)
  current_stock      Decimal?           @default(0) @db.Decimal(10, 2)
  minimum_stock      Decimal?           @default(0) @db.Decimal(10, 2)
  created_at         DateTime?          @default(now()) @db.Timestamp(6)
  lab_material_usage LabMaterialUsage[]
  labs               Lab                @relation(fields: [lab_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model WhiteboardSession {
  id            String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  schoolId      String                  @map("school_id") @db.Uuid
  hostId        String                  @map("host_id") @db.Uuid
  title         String?                 @db.VarChar(255)
  status        WhiteboardSessionStatus @default(active)
  targetType    WhiteboardTargetType?   @map("target_type")
  targetClassId String?                 @map("target_class_id") @db.Uuid
  targetGroupId String?                 @map("target_group_id") @db.Uuid
  startedAt     DateTime?               @default(now()) @map("started_at") @db.Timestamp(6)
  endedAt       DateTime?               @map("ended_at") @db.Timestamp(6)
  recordingUrl  String?                 @map("recording_url")
  isRecording   Boolean?                @default(false) @map("is_recording")
  canvasData    String?                 @map("canvas_data")
  createdAt     DateTime?               @default(now()) @map("created_at") @db.Timestamp(6)
  participants  WhiteboardParticipant[]
  host          User                    @relation("WhiteboardHost", fields: [hostId], references: [id], onDelete: Cascade)
  school        School                  @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  targetClass   Class?                  @relation(fields: [targetClassId], references: [id])
  targetGroup   StudentGroup?           @relation(fields: [targetGroupId], references: [id])

  @@index([schoolId], map: "idx_whiteboard_sessions_school")
  @@index([hostId], map: "idx_whiteboard_sessions_host")
  @@index([status], map: "idx_whiteboard_sessions_status")
  @@map("whiteboard_sessions")
}

model WhiteboardParticipant {
  id        String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId String                    @map("session_id") @db.Uuid
  userId    String                    @map("user_id") @db.Uuid
  role      WhiteboardParticipantRole @default(viewer)
  joinedAt  DateTime?                 @default(now()) @map("joined_at") @db.Timestamp(6)
  leftAt    DateTime?                 @map("left_at") @db.Timestamp(6)
  isActive  Boolean?                  @default(true) @map("is_active")
  session   WhiteboardSession         @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([sessionId, userId], map: "unique_participant_per_session")
  @@index([sessionId], map: "idx_whiteboard_participants_session")
  @@index([userId], map: "idx_whiteboard_participants_user")
  @@map("whiteboard_participants")
}

model AuditLog {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String?   @map("user_id") @db.Uuid
  schoolId   String?   @map("school_id") @db.Uuid
  action     String    @db.VarChar(50)
  entityType String    @map("entity_type") @db.VarChar(50)
  entityId   String?   @map("entity_id") @db.Uuid
  entityName String?   @map("entity_name") @db.VarChar(255)
  details    Json?
  ipAddress  String?   @map("ip_address") @db.VarChar(45)
  userAgent  String?   @map("user_agent")
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  school     School?   @relation(fields: [schoolId], references: [id])
  user       User?     @relation(fields: [userId], references: [id])

  @@index([userId], map: "idx_audit_logs_user")
  @@index([entityType, entityId], map: "idx_audit_logs_entity")
  @@index([createdAt(sort: Desc)], map: "idx_audit_logs_created")
  @@index([schoolId], map: "idx_audit_logs_school")
  @@index([action], map: "idx_audit_logs_action")
  @@map("audit_logs")
}

model SiteUpdate {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  version     String   @db.VarChar(20)
  description String
  changes     String?
  updatedAt   DateTime @default(now()) @map("updated_at") @db.Timestamp(6)
  updatedBy   String?  @map("updated_by") @db.VarChar(100)

  @@map("site_updates")
}

model Ticket {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ticketNumber    String           @unique @map("ticket_number") @db.VarChar(20)
  title           String           @db.VarChar(200)
  description     String
  category        TicketCategory   @default(other)
  priority        TicketPriority   @default(medium)
  status          TicketStatus     @default(open)
  itemId          String?          @map("item_id") @db.Uuid
  labId           String?          @map("lab_id") @db.Uuid
  issueTypeId     String?          @map("issue_type_id") @db.Uuid
  createdById     String           @map("created_by_id") @db.Uuid
  assignedToId    String?          @map("assigned_to_id") @db.Uuid
  resolvedById    String?          @map("resolved_by_id") @db.Uuid
  createdAt       DateTime         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime         @updatedAt @map("updated_at") @db.Timestamp(6)
  resolvedAt      DateTime?        @map("resolved_at") @db.Timestamp(6)
  resolutionNotes String?          @map("resolution_notes")
  comments        TicketComment[]
  assignedTo      User?            @relation("TicketAssignee", fields: [assignedToId], references: [id])
  createdBy       User             @relation("TicketCreator", fields: [createdById], references: [id])
  issueType       TicketIssueType? @relation(fields: [issueTypeId], references: [id])
  item            LabItem?         @relation(fields: [itemId], references: [id])
  lab             Lab?             @relation(fields: [labId], references: [id])
  resolvedBy      User?            @relation("TicketResolver", fields: [resolvedById], references: [id])

  @@index([status])
  @@index([createdById])
  @@index([labId])
  @@map("tickets")
}

model TicketComment {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ticketId  String   @map("ticket_id") @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  content   String
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  ticket    Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@map("ticket_comments")
}

model TicketIssueType {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  category     TicketCategory
  name         String         @db.VarChar(100)
  description  String?
  displayOrder Int            @default(0) @map("display_order")
  isActive     Boolean        @default(true) @map("is_active")
  createdAt    DateTime       @default(now()) @map("created_at") @db.Timestamp(6)
  tickets      Ticket[]

  @@index([category])
  @@map("ticket_issue_types")
}

model LaptopIssuance {
  id                      String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  laptopId                String         @map("laptop_id") @db.Uuid
  issuedToId              String         @map("issued_to_id") @db.Uuid
  issuedById              String         @map("issued_by_id") @db.Uuid
  voucherNumber           String         @unique @map("voucher_number") @db.VarChar(30)
  purpose                 String?
  issuedAt                DateTime       @default(now()) @map("issued_at") @db.Timestamp(6)
  expectedReturnDate      DateTime?      @map("expected_return_date") @db.Date
  returnedAt              DateTime?      @map("returned_at") @db.Timestamp(6)
  receivedById            String?        @map("received_by_id") @db.Uuid
  conditionOnIssue        String?        @default("good") @map("condition_on_issue") @db.VarChar(50)
  conditionOnReturn       String?        @map("condition_on_return") @db.VarChar(50)
  componentStatus         Json?          @default("{}") @map("component_status")
  componentStatusOnReturn Json?          @map("component_status_on_return")
  remarks                 String?
  returnRemarks           String?        @map("return_remarks")
  status                  IssuanceStatus @default(issued)
  schoolId                String         @map("school_id") @db.Uuid
  createdAt               DateTime       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt               DateTime       @updatedAt @map("updated_at") @db.Timestamp(6)
  issuedBy                User           @relation("LaptopIssuedBy", fields: [issuedById], references: [id])
  issuedTo                User           @relation("LaptopIssuedTo", fields: [issuedToId], references: [id])
  laptop                  LabItem        @relation(fields: [laptopId], references: [id], onDelete: Cascade)
  receivedBy              User?          @relation("LaptopReceivedBy", fields: [receivedById], references: [id])
  school                  School         @relation(fields: [schoolId], references: [id])

  @@index([laptopId])
  @@index([issuedToId])
  @@index([status])
  @@index([schoolId])
  @@map("laptop_issuances")
}

model Vendor {
  id            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String            @db.VarChar(200)
  contactPerson String?           @map("contact_person") @db.VarChar(100)
  email         String?           @db.VarChar(100)
  phone         String?           @db.VarChar(20)
  address       String?
  gstin         String?           @db.VarChar(20)
  isLocal       Boolean           @default(false) @map("is_local")
  schoolId      String            @map("school_id") @db.Uuid
  createdAt     DateTime          @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime          @updatedAt @map("updated_at") @db.Timestamp(6)
  approvedItems ProcurementItem[] @relation("ApprovedVendor")
  quotations    VendorQuotation[]
  school        School            @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@index([schoolId])
  @@map("vendors")
}

model ProcurementRequest {
  id                 String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String                 @db.VarChar(200)
  description        String?
  purpose            String?
  department         String?                @db.VarChar(100)
  budgetCode         String?                @map("budget_code") @db.VarChar(50)
  purchaseLetterUrl  String?                @map("purchase_letter_url") @db.VarChar(500)
  purchaseLetterName String?                @map("purchase_letter_name") @db.VarChar(255)
  letterContent      String?                @map("letter_content")
  currentStep        Int?                   @default(1) @map("current_step")
  selectedVendorIds  String[]               @default([]) @map("selected_vendor_ids") @db.Uuid
  estimatedTotal     Decimal?               @map("estimated_total") @db.Decimal(14, 2)
  approvedTotal      Decimal?               @map("approved_total") @db.Decimal(14, 2)
  status             ProcurementStatus      @default(draft)
  createdById        String                 @map("created_by_id") @db.Uuid
  approvedById       String?                @map("approved_by_id") @db.Uuid
  approvedAt         DateTime?              @map("approved_at") @db.Timestamp(6)
  orderedAt          DateTime?              @map("ordered_at") @db.Timestamp(6)
  poNumber           String?                @map("po_number") @db.VarChar(100)
  poUrl              String?                @map("po_url") @db.VarChar(500)
  billNumber         String?                @map("bill_number") @db.VarChar(100)
  billDate           DateTime?              @map("bill_date") @db.Date
  billAmount         Decimal?               @map("bill_amount") @db.Decimal(14, 2)
  billUrl            String?                @map("bill_url") @db.VarChar(500)
  paymentMethod      String?                @map("payment_method") @db.VarChar(50)
  chequeNumber       String?                @map("cheque_number") @db.VarChar(50)
  chequeUrl          String?                @map("cheque_url") @db.VarChar(500)
  paymentDate        DateTime?              @map("payment_date") @db.Date
  paymentReference   String?                @map("payment_reference") @db.VarChar(100)
  receivedAt         DateTime?              @map("received_at") @db.Timestamp(6)
  receivedById       String?                @map("received_by_id") @db.Uuid
  receivingVideoUrl  String?                @map("receiving_video_url") @db.VarChar(500)
  receivingNotes     String?                @map("receiving_notes")
  schoolId           String                 @map("school_id") @db.Uuid
  createdAt          DateTime               @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime               @updatedAt @map("updated_at") @db.Timestamp(6)
  committee          ProcurementCommittee[]
  items              ProcurementItem[]
  approvedBy         User?                  @relation("ProcurementApprovedBy", fields: [approvedById], references: [id])
  createdBy          User                   @relation("ProcurementCreatedBy", fields: [createdById], references: [id])
  receivedBy         User?                  @relation("ProcurementReceivedBy", fields: [receivedById], references: [id])
  school             School                 @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  quotations         VendorQuotation[]

  @@index([schoolId])
  @@index([status])
  @@map("procurement_requests")
}

model ProcurementItem {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requestId          String             @map("request_id") @db.Uuid
  itemName           String             @map("item_name") @db.VarChar(200)
  description        String?
  specifications     String?
  quantity           Int                @default(1)
  unit               String?            @default("pcs") @db.VarChar(50)
  estimatedUnitPrice Decimal?           @map("estimated_unit_price") @db.Decimal(12, 2)
  approvedUnitPrice  Decimal?           @map("approved_unit_price") @db.Decimal(12, 2)
  approvedVendorId   String?            @map("approved_vendor_id") @db.Uuid
  isReceived         Boolean            @default(false) @map("is_received")
  receivedQty        Int                @default(0) @map("received_qty")
  serialNumbers      Json?              @map("serial_numbers")
  receivedAt         DateTime?          @map("received_at") @db.Timestamp(6)
  receivedById       String?            @map("received_by_id") @db.Uuid
  inventoryItemId    String?            @map("inventory_item_id") @db.Uuid
  createdAt          DateTime           @default(now()) @map("created_at") @db.Timestamp(6)
  approvedVendor     Vendor?            @relation("ApprovedVendor", fields: [approvedVendorId], references: [id])
  inventoryItem      LabItem?           @relation(fields: [inventoryItemId], references: [id])
  request            ProcurementRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  receivedBy         User?              @relation("ProcurementItemReceivedBy", fields: [receivedById], references: [id])
  quotationItems     QuotationItem[]

  @@index([requestId])
  @@index([isReceived])
  @@map("procurement_items")
}

model VendorQuotation {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requestId       String             @map("request_id") @db.Uuid
  vendorId        String             @map("vendor_id") @db.Uuid
  quotationNumber String?            @map("quotation_number") @db.VarChar(50)
  quotationDate   DateTime?          @map("quotation_date") @db.Date
  validUntil      DateTime?          @map("valid_until") @db.Date
  documentUrl     String?            @map("document_url") @db.VarChar(500)
  totalAmount     Decimal?           @map("total_amount") @db.Decimal(14, 2)
  terms           String?
  remarks         String?
  createdAt       DateTime           @default(now()) @map("created_at") @db.Timestamp(6)
  items           QuotationItem[]
  request         ProcurementRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  vendor          Vendor             @relation(fields: [vendorId], references: [id])

  @@index([requestId])
  @@index([vendorId])
  @@map("vendor_quotations")
}

model QuotationItem {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quotationId       String          @map("quotation_id") @db.Uuid
  procurementItemId String          @map("procurement_item_id") @db.Uuid
  unitPrice         Decimal         @map("unit_price") @db.Decimal(12, 2)
  quantity          Int?
  totalPrice        Decimal?        @map("total_price") @db.Decimal(12, 2)
  remarks           String?
  procurementItem   ProcurementItem @relation(fields: [procurementItemId], references: [id], onDelete: Cascade)
  quotation         VendorQuotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)

  @@index([quotationId])
  @@index([procurementItemId])
  @@map("quotation_items")
}

model ProcurementCommittee {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requestId   String             @map("request_id") @db.Uuid
  userId      String             @map("user_id") @db.Uuid
  role        String?            @default("member") @db.VarChar(50)
  designation String?            @db.VarChar(100)
  addedAt     DateTime           @default(now()) @map("added_at") @db.Timestamp(6)
  request     ProcurementRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([requestId, userId])
  @@index([requestId])
  @@index([userId])
  @@map("procurement_committee")
}

enum WhiteboardSessionStatus {
  active
  paused
  ended
}

enum WhiteboardTargetType {
  class
  group
  student
}

enum WhiteboardParticipantRole {
  host
  cohost
  viewer
}

enum UserRole {
  admin
  principal
  instructor
  student
  accountant
  lab_assistant
}

enum EnrollmentStatus {
  active
  transferred
  dropped
  graduated
}

enum GroupRole {
  leader
  member
}

enum EquipmentShiftStatus {
  pending
  approved
  rejected
  completed

  @@map("equipment_shift_status")
}

enum AssignmentType {
  program
  experiment
  project
  observation
  viva_only
}

enum AssignmentStatus {
  draft
  published
  archived
}

enum TargetType {
  class
  group
  student
}

enum SubmissionStatus {
  draft
  submitted
  under_review
  needs_revision
  viva_scheduled
  viva_completed
  graded
  returned
}

enum VivaMode {
  online
  offline
  recorded
}

enum VivaStatus {
  scheduled
  in_progress
  completed
  cancelled
  rescheduled
  no_show
}

enum ParticipantStatus {
  waiting
  admitted
  in_session
  left
  rejected
}

enum DifficultyLevel {
  easy
  medium
  hard
}

enum FeeFrequency {
  monthly
  quarterly
  half_yearly
  yearly
  one_time
}

enum FeeStatus {
  pending
  partial
  paid
  overdue
  waived
}

enum PaymentMode {
  cash
  cheque
  bank_transfer
  upi
  card
}

enum ActivityType {
  login
  logout
  submission
  grade
  assignment
  payment
  viva
  other
}

enum AttendanceStatus {
  present
  absent
  late
  excused
}

enum ReportType {
  progress
  attendance
  grade_sheet
  fee_receipt
  certificate
}

enum NotificationChannel {
  email
  sms
  push
  whatsapp
}

enum NotificationStatus {
  pending
  sent
  delivered
  failed
  read
}

enum MaterialUnit {
  piece
  ml
  gram
  kg
  litre
  set
}

enum document_share_target_type {
  class
  group
  instructor
  admin
  student
}

enum TicketStatus {
  open
  in_progress
  resolved
  closed

  @@map("ticket_status")
}

enum TicketPriority {
  low
  medium
  high
  critical

  @@map("ticket_priority")
}

enum TicketCategory {
  hardware_issue
  software_issue
  maintenance_request
  general_complaint
  other

  @@map("ticket_category")
}

enum IssuanceStatus {
  issued
  returned
  overdue
  lost

  @@map("issuance_status")
}

enum ProcurementStatus {
  draft
  quotation_requested
  quotes_received
  approved
  ordered
  billed
  paid
  received
  completed
  cancelled

  @@map("procurement_status")
}

// Query Log for monitoring database queries
model QueryLog {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  query       String   @db.Text
  params      String?  @db.Text
  duration    Int?     // milliseconds
  error       String?  @db.Text
  success     Boolean  @default(true)
  model       String?  @db.VarChar(100)
  action      String?  @db.VarChar(50)
  userId      String?  @map("user_id") @db.Uuid
  userEmail   String?  @map("user_email") @db.VarChar(255)
  ipAddress   String?  @map("ip_address") @db.VarChar(45)
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("query_logs")
  @@index([createdAt])
  @@index([success])
  @@index([model])
}
